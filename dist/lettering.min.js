!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Lettering=e()}(this,function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},i=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},s=function(t){return"function"==typeof t||!1},a=function(){function n(){t(this,n),this.listeners={}}return e(n,[{key:"addListener",value:function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)}},{key:"once",value:function(t,e){var n=this,i=!1;this.addListener(t,function(){n.removeListener(t,e),i||(i=!0,e.apply(void 0,arguments))})}},{key:"removeListener",value:function(t,e){var n=this.listeners[t];n&&(this.listeners[t]=n.filter(function(t){return!(s(t)&&t===e)}))}},{key:"emit",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var r=this.listeners[t];r&&r.length&&r.forEach(function(t){return t.apply(void 0,n)})}}]),n}(),o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},c=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(t){clearTimeout(t)},u=function(t){throw new Error("Missing Parameter: "+t)},h=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},l=function(t,e){return Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}(["el"],["el"]),f={fps:15,autoStart:!0,caretShow:!0,caretContent:"|",caretClassName:"lettering-caret"};return function(s){function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u(l),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f;t(this,a);var s=r(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));s.el="string"==typeof e?document.querySelector(e):e,s.el.children.length&&console.warn("lettering:","HTMLCollection in the element will be ignored, only text inside will remain"),s.isInput=!!s.el.placeholder,s.string=s.isInput?s.el.placeholder:s.el.innerText,s.target=s.isInput?"placeholder":"textContent",s.outputElement=s.isInput?s.el:document.createElement("span"),s.options=n({},f,i),s.caretShow=s.options.caretShow&&!s.isInput;var o=void 0;return Object.defineProperties(s,{caretElement:{value:document.createElement("span")},stringIndex:{get:function(){return o},set:function(t){t<0&&(t=0),t>this.maxStringIndex&&(t=this.maxStringIndex),o=t}}}),s.maxStringIndex=s.string.length+1,s.stringIndex=1,s.isBackspace=!1,s.isAnitmating=!1,s.lastTime=null,s.requestId=null,s._init(),s}return i(a,s),e(a,[{key:"_init",value:function(){this._refresh(!0),this.caretShow&&this._createCaret()._cssCaret()._caretBlink(),this.options.autoStart&&this.typing()}},{key:"_refresh",value:function(t){return t&&(h(this.el),this.isInput||this.el.appendChild(this.outputElement),this.stringIndex),this.maxStringIndex=this.string.length+1,this}},{key:"_createCaret",value:function(){return this.caret=document.createElement("span"),this.el.appendChild(this.caret),this}},{key:"_cssCaret",value:function(){return this.caret.className=this.options.caretClassName,this.caret.innerHTML=this.options.caretContent,this.caret.style.opacity=1,this}},{key:"_caretBlink",value:function(){var t=this,e=Date.now();!function n(){var i=Date.now();i-e>500&&(--t.caret.style.opacity<0&&(t.caret.style.opacity=1),e=i),o(n.bind(t))}()}},{key:"_renderChar",value:function(){var t=this.string.substring(0,this.stringIndex);this.outputElement[this.target]=t}},{key:"_printChar",value:function(){this._renderChar(),this.stringIndex++}},{key:"_removeChar",value:function(){this.stringIndex--,this._renderChar()}},{key:"_animate",value:function(){if(this.isAnitmating){var t=Date.now();return t-this.lastTime>1e3/this.options.fps&&(this.caretShow&&(this.caret.style.opacity=1),this.isBackspace?this._removeChar():this._printChar(),this.lastTime=t),this.stringIndex===this.maxStringIndex?this._stop().emit("afterTyping"):0===this.stringIndex?this._stop().emit("afterBackspace"):this.isAnitmating?this.requestId=o(this._animate.bind(this)):void 0}}},{key:"updateContent",value:function(t){var e=this;return this.backspace().once("afterBackspace",function(){e.string=t,e._refresh().typing()}),this}},{key:"typing",value:function(){return this.isAnitmating=!0,this.isBackspace=!1,this.lastTime=Date.now(),this._animate(),this}},{key:"backspace",value:function(){return this.isAnitmating=!0,this.isBackspace=!0,this.lastTime=Date.now(),this._animate(),this}},{key:"_stop",value:function(){return c(this.requestId),this.isAnitmating=!1,this.isBackspace?this.stringIndex++:this.stringIndex--,this}}]),a}(a)});

(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
	typeof define === 'function' && define.amd ? define(factory) :
	(global.Lettering = factory());
}(this, (function () { 'use strict';

var classCallCheck = function (instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
};

var createClass = function () {
  function defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  return function (Constructor, protoProps, staticProps) {
    if (protoProps) defineProperties(Constructor.prototype, protoProps);
    if (staticProps) defineProperties(Constructor, staticProps);
    return Constructor;
  };
}();







var _extends = Object.assign || function (target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i];

    for (var key in source) {
      if (Object.prototype.hasOwnProperty.call(source, key)) {
        target[key] = source[key];
      }
    }
  }

  return target;
};

























var taggedTemplateLiteral = function (strings, raw) {
  return Object.freeze(Object.defineProperties(strings, {
    raw: {
      value: Object.freeze(raw)
    }
  }));
};

var _templateObject = taggedTemplateLiteral(['el'], ['el']);

var rAF = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function (callback) {
  window.setTimeout(callback, 1000 / 60);
};

// define cancelAnimationFrame function
var cAF = window.cancelAnimationFrame || window.webkitCancelAnimationFrame;

var x = function x(p) {
  throw new Error('Missing Parameter: ' + p);
};

var defaultOptions = {
  fps: 10
};

var Lettering = function () {
  /**
   * Creates an instance of Lettering.
   * @param {HTMLElement} el required
   * @param {object} options configs
   * 
   * @memberof Lettering
   */
  function Lettering() {
    var el = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : x(_templateObject);
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultOptions;
    classCallCheck(this, Lettering);

    // init type element
    this.el = typeof el === 'string' ? document.querySelector(el) : el;
    if (!!this.el.children.length) console.warn('lettering:', 'HTMLCollection in the element will be ignored, only text inside will remain');
    // init options
    this.options = _extends({}, defaultOptions, options);
    // string inside the element
    this.string = this.el.innerText;

    var _index = void 0;
    Object.defineProperties(this, {
      // cause using String.substring function
      'maxStringIndex': { value: this.string.length + 1 },
      'stringIndex': {
        get: function get$$1() {
          return _index;
        },
        set: function set$$1(value) {
          if (value < 0) value = 0;
          if (value > this.maxStringIndex) value = this.maxStringIndex;
          _index = value;
        }
      }
    });

    this.stringIndex = 1;
    // time stamp used to control frame speed, set to null initialize
    this.lastTime = null;
    this.requestId = null;
    this.isAnitmating = false;
    this.isBackspace = false;

    this._init();
  }

  createClass(Lettering, [{
    key: '_init',
    value: function _init() {
      // this.typing();
    }
  }, {
    key: '_printChar',
    value: function _printChar() {
      this.el.textContent = this.string.substring(0, this.stringIndex);
      this.stringIndex++;
    }
  }, {
    key: '_removeChar',
    value: function _removeChar() {
      this.el.textContent = this.string.substring(0, this.stringIndex - 1);
      this.stringIndex--;
    }
  }, {
    key: '_animate',
    value: function _animate() {
      // create new time stamp
      var now = Date.now();
      // calculate time delta
      var delta = now - this.lastTime;
      // the 1000 here means 1000ms;
      var shouldAnimate = delta > 1000 / this.options.fps;
      // main animation here
      if (shouldAnimate) {
        // print char into document
        this.isBackspace ? this._removeChar() : this._printChar();
        // update timestamp to calculate delta again
        this.lastTime = now;
      }
      if (this.stringIndex === this.maxStringIndex || this.stringIndex === 0) return this.stop();
      if (this.isAnitmating) return this.requestId = rAF(this._animate.bind(this));
    }
  }, {
    key: 'typing',
    value: function typing() {
      this.isBackspace = false;
      this.isAnitmating = true;
      this.lastTime = Date.now();

      this._animate();
    }
  }, {
    key: 'backspace',
    value: function backspace() {
      this.isBackspace = true;
      this.isAnitmating = true;
      this.lastTime = Date.now();

      this._animate();
    }
  }, {
    key: 'stop',
    value: function stop() {
      cAF(this.requestId);
      this.isAnitmating = false;
      this.isBackspace ? this.stringIndex++ : this.stringIndex--;
    }
  }]);
  return Lettering;
}();

return Lettering;

})));
